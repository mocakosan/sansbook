{"ast":null,"code":"var _jsxFileName = \"/Users/js/Desktop/sansbook/pages/profile.js\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport AppLayout from \"../components/AppLayout\";\nimport Head from \"next/head\";\nimport NicknameEditForm from \"../components/NicknameEditForm\";\nimport FollowList from \"../components/FollowList\";\nimport { useSelector } from \"react-redux\";\nimport { useEffect, useState } from \"react\";\nimport Router from \"next/router\";\nimport { LOAD_MY_INFO_REQUEST } from \"../reducers/user\";\nimport useSWR from \"swr\";\nimport axios from \"axios\";\nimport wrapper from \"../store/configureStore\";\nimport { END } from \"redux-saga\";\nconst fetcher = url => axios.get(url, {\n  withCredentials: true\n}).then(result => result.data);\nconst Profile = () => {\n  const {\n    0: followingsLimit,\n    1: setFollowingsLimit\n  } = useState(3);\n  const {\n    0: followersLimit,\n    1: setFollowersLimit\n  } = useState(3);\n  const {\n    data: followersData,\n    error: followerError\n  } = useSWR(`http://localhost:3065/user/followers?limit=${followersLimit}`, fetcher);\n  const {\n    data: followingsData,\n    error: followingError\n  } = useSWR(`http://localhost:3065/user/followings?limit=${followingsLimit}`, fetcher);\n  const {\n    me\n  } = useSelector(state => state.user);\n  // useEffect(() => {\n  //   dispatch({\n  //     type: LOAD_FOLLOWINGS_REQUEST,\n  //   });\n  //   dispatch({\n  //     type: LOAD_FOLLOWERS_REQUEST,\n  //   });\n  // }, []);\n  console.log(\"@@@@@@\", me);\n  useEffect(() => {\n    if (!(me && me.id)) {\n      Router.push(\"/\");\n    }\n  }, [me && me.id]);\n  const loadMoreFollowers = useCallback(() => {\n    setFollowersLimit(prev => prev + 3);\n  }, []);\n  const loadMoreFollowings = useCallback(() => {\n    setFollowingsLimit(prev => prev + 3);\n  }, []);\n  if (!me) {\n    return \"내정보 로딩중\";\n  }\n  if (followerError || followingError) {\n    console.error(followerError || followingError);\n    return \"팔로잉/팔로워 로딩 중 에러가 발생했습니다.\";\n  }\n  return __jsx(React.Fragment, null, __jsx(Head, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 7\n    }\n  }, __jsx(\"title\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 9\n    }\n  }, \"\\uB0B4\\uD504\\uB85C\\uD544 | Sansbook \")), __jsx(AppLayout, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 7\n    }\n  }, __jsx(NicknameEditForm, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 9\n    }\n  }), __jsx(FollowList, {\n    header: \"\\uD314\\uB85C\\uC789 \\uBAA9\\uB85D\",\n    data: followingsData,\n    onClickMore: loadMoreFollowings(),\n    loading: !followingError && !followingsData,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 69,\n      columnNumber: 9\n    }\n  }), __jsx(FollowList, {\n    header: \"\\uD314\\uB85C\\uC6CC \\uBAA9\\uB85D\",\n    data: followersData,\n    onClickMore: loadMoreFollowers(),\n    loading: !followerError && !followersData,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 9\n    }\n  })));\n};\n\n//SSR : next전용 서버사이드 렌더링 = 사용\nexport const getServerSideProps = wrapper.getServerSideProps(store => async context => {\n  const cookie = context.req ? context.req.headers.cookie : \"\";\n  axios.defaults.headers.Cookie = \"\";\n  if (context.req && cookie) {\n    //쿠키를 써서 요청을 보냈을떄만 잠시 보관해두었다가 쿠키 안써서 요청보낼떄는 서버에서 공유하고 있는 쿠키를 제거하는\n    axios.defaults.headers.Cookie = cookie; //잘못하면 내 뒤로 로그인하는 사람이 내쿠키를 공유해서 내정보로 로그인하는 현상이 일어나서 해두는 조치\n  }\n\n  store.dispatch({\n    type: LOAD_MY_INFO_REQUEST\n  });\n  store.dispatch(END);\n  await store.sagaTask.toPromise();\n  return {\n    props: {}\n  };\n});\nexport default Profile;","map":{"version":3,"names":["AppLayout","Head","NicknameEditForm","FollowList","useSelector","useEffect","useState","Router","LOAD_MY_INFO_REQUEST","useSWR","axios","wrapper","END","fetcher","url","get","withCredentials","then","result","data","Profile","followingsLimit","setFollowingsLimit","followersLimit","setFollowersLimit","followersData","error","followerError","followingsData","followingError","me","state","user","console","log","id","push","loadMoreFollowers","useCallback","prev","loadMoreFollowings","__jsx","React","Fragment","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","header","onClickMore","loading","getServerSideProps","store","context","cookie","req","headers","defaults","Cookie","dispatch","type","sagaTask","toPromise","props"],"sources":["/Users/js/Desktop/sansbook/pages/profile.js"],"sourcesContent":["import AppLayout from \"../components/AppLayout\";\nimport Head from \"next/head\";\nimport NicknameEditForm from \"../components/NicknameEditForm\";\nimport FollowList from \"../components/FollowList\";\nimport { useSelector } from \"react-redux\";\nimport { useEffect, useState } from \"react\";\nimport Router from \"next/router\";\nimport { LOAD_MY_INFO_REQUEST } from \"../reducers/user\";\nimport useSWR from \"swr\";\nimport axios from \"axios\";\nimport wrapper from \"../store/configureStore\";\nimport { END } from \"redux-saga\";\n\nconst fetcher = (url) =>\n  axios.get(url, { withCredentials: true }).then((result) => result.data);\n\nconst Profile = () => {\n  const [followingsLimit, setFollowingsLimit] = useState(3);\n  const [followersLimit, setFollowersLimit] = useState(3);\n  const { data: followersData, error: followerError } = useSWR(\n    `http://localhost:3065/user/followers?limit=${followersLimit}`,\n    fetcher\n  );\n  const { data: followingsData, error: followingError } = useSWR(\n    `http://localhost:3065/user/followings?limit=${followingsLimit}`,\n    fetcher\n  );\n\n  const { me } = useSelector((state) => state.user);\n  // useEffect(() => {\n  //   dispatch({\n  //     type: LOAD_FOLLOWINGS_REQUEST,\n  //   });\n  //   dispatch({\n  //     type: LOAD_FOLLOWERS_REQUEST,\n  //   });\n  // }, []);\n  console.log(\"@@@@@@\", me);\n  useEffect(() => {\n    if (!(me && me.id)) {\n      Router.push(\"/\");\n    }\n  }, [me && me.id]);\n\n  const loadMoreFollowers = useCallback(() => {\n    setFollowersLimit((prev) => prev + 3);\n  }, []);\n\n  const loadMoreFollowings = useCallback(() => {\n    setFollowingsLimit((prev) => prev + 3);\n  }, []);\n\n  if (!me) {\n    return \"내정보 로딩중\";\n  }\n\n  if (followerError || followingError) {\n    console.error(followerError || followingError);\n    return \"팔로잉/팔로워 로딩 중 에러가 발생했습니다.\";\n  }\n\n  return (\n    <>\n      <Head>\n        <title>내프로필 | Sansbook </title>\n      </Head>\n      <AppLayout>\n        <NicknameEditForm />\n        <FollowList\n          header=\"팔로잉 목록\"\n          data={followingsData}\n          onClickMore={loadMoreFollowings()}\n          loading={!followingError && !followingsData}\n        />\n        <FollowList\n          header=\"팔로워 목록\"\n          data={followersData}\n          onClickMore={loadMoreFollowers()}\n          loading={!followerError && !followersData}\n        />\n      </AppLayout>\n    </>\n  );\n};\n\n//SSR : next전용 서버사이드 렌더링 = 사용\nexport const getServerSideProps = wrapper.getServerSideProps(\n  (store) => async (context) => {\n    const cookie = context.req ? context.req.headers.cookie : \"\";\n    axios.defaults.headers.Cookie = \"\";\n    if (context.req && cookie) {\n      //쿠키를 써서 요청을 보냈을떄만 잠시 보관해두었다가 쿠키 안써서 요청보낼떄는 서버에서 공유하고 있는 쿠키를 제거하는\n      axios.defaults.headers.Cookie = cookie; //잘못하면 내 뒤로 로그인하는 사람이 내쿠키를 공유해서 내정보로 로그인하는 현상이 일어나서 해두는 조치\n    }\n    store.dispatch({\n      type: LOAD_MY_INFO_REQUEST,\n    });\n\n    store.dispatch(END);\n    await store.sagaTask.toPromise();\n    return { props: {} };\n  }\n);\n\nexport default Profile;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}